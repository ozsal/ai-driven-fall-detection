# Mosquitto MQTT Broker Configuration with TLS/SSL
# Copy this file to /etc/mosquitto/conf.d/mqtt_tls.conf
# Or include it in the main mosquitto.conf file

# Listen on port 8883 for TLS connections
listener 8883
protocol mqtt

# TLS/SSL Configuration
cafile /etc/mosquitto/certs/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile /etc/mosquitto/certs/server.key

# TLS Version (recommended: tlsv1.2 or tlsv1.3)
tls_version tlsv1.2

# Require client certificates for mutual TLS (optional)
# Set to true for mutual TLS authentication (client must present valid certificate)
# Set to false to use only server certificate (client verifies server)
require_certificate false

# Certificate Authority file for verifying client certificates (for mutual TLS)
# Only needed if require_certificate is true
# cafile /etc/mosquitto/certs/ca.crt

# Authentication (optional, can use username/password along with TLS)
allow_anonymous false
password_file /etc/mosquitto/passwd
acl_file /etc/mosquitto/acl

# Also listen on port 1883 for non-TLS connections (optional)
# Comment out if you want TLS-only access
listener 1883
protocol mqtt
allow_anonymous false
password_file /etc/mosquitto/passwd
acl_file /etc/mosquitto/acl

# Logging
log_dest file /var/log/mosquitto/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information
connection_messages true

# Persistence
persistence true
persistence_location /var/lib/mosquitto/

# Maximum number of queued messages
max_queued_messages 1000

# Message size limit (in bytes)
message_size_limit 268435456

# Connection timeout
keepalive_interval 60

